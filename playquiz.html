<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Play Quiz - QuizHub</title>
<link rel="stylesheet" href="style.css">
<style>
body {
  background: #00121a;
  font-family: 'Poppins', sans-serif;
  color: #c0f0ff;
  margin: 0;
  padding: 0;
}
nav {
  display: flex;
  gap: 1rem;
  background: #011a27;
  padding: 1rem 2rem;
  box-shadow: 0 0 15px #0ff;
}
nav a {
  color: #0ff;
  text-decoration: none;
  font-weight: bold;
  transition: 0.3s;
}
nav a:hover { color: #00f; text-shadow: 0 0 10px #0ff; }
.container {
  max-width: 700px;
  margin: 2rem auto;
  padding: 2rem;
}
h2 {
  text-align: center;
  color: #0ff;
  margin-bottom: 1.5rem;
  text-shadow: 0 0 10px #0ff;
}
.card {
  background: #011a27;
  padding: 1rem;
  margin-bottom: 1rem;
  border-radius: 10px;
  box-shadow: 0 0 10px #0ff;
}
.card p {
  margin: 0 0 0.5rem 0;
}
.card input {
  width: 100%;
  padding: 0.5rem;
  margin-top: 0.5rem;
  border-radius: 5px;
  border: 1px solid #0ff;
  background: #022b3a;
  color: #c0f0ff;
}
button {
  padding: 0.6rem 1.2rem;
  border-radius: 8px;
  border: 1px solid #0ff;
  background: #011a27;
  color: #0ff;
  cursor: pointer;
  transition: all 0.3s ease;
  display: block;
  margin: 1rem auto;
}
button:hover {
  transform: scale(1.05);
  box-shadow: 0 0 15px #0ff, 0 0 30px #00f inset;
}
</style>
</head>
<body>
<nav>
  <a href="global.html">← Back to Quizzes</a>
</nav>

<div class="container">
  <h2 id="quizTitle">Loading quiz...</h2>
  <form id="quizForm"></form>
  <button id="submitBtn">Submit Answers</button>
</div>

<footer style="text-align:center; padding:1rem; color:#0ff; box-shadow:0 0 15px #0ff; margin-top:2rem;">
  <p>© 2025 QuizHub | All rights reserved</p>
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
import { getDatabase, ref, get, push } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";

// Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyCTQxhVWq6yugqmZdx93JApQD4ODru56D4",
  authDomain: "quizhub-d5b40.firebaseapp.com",
  databaseURL: "https://quizhub-d5b40-default-rtdb.firebaseio.com",
  projectId: "quizhub-d5b40",
  storageBucket: "quizhub-d5b40.firebasestorage.app",
  messagingSenderId: "635722320170",
  appId: "1:635722320170:web:6094dbf608de89510af653"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// DOM elements
const form = document.getElementById('quizForm');
const quizTitleEl = document.getElementById('quizTitle');
const submitBtn = document.getElementById('submitBtn');

// Get quizId from URL
const urlParams = new URLSearchParams(window.location.search);
const quizId = urlParams.get('quiz');

async function loadQuiz() {
  let quiz = null;

  // Try loading from Firebase first
  if (quizId) {
    const snapshot = await get(ref(db, 'quizzes/' + quizId));
    if (snapshot.exists()) {
      quiz = snapshot.val();
    }
  }

  // Fallback to localStorage if not found in Firebase
  if (!quiz) {
    const localQuizzes = JSON.parse(localStorage.getItem('myQuizzes')) || [];
    if (quizId) {
      quiz = localQuizzes.find(q => q.createdAt == quizId);
    } else {
      quiz = localQuizzes[localQuizzes.length - 1];
    }
  }

  if (!quiz) {
    alert("Quiz not found!");
    window.location.href = 'global.html';
    return;
  }

  displayQuiz(quiz);
}

function displayQuiz(quiz) {
  quizTitleEl.innerText = quiz.title;
  form.innerHTML = '';

  quiz.questions.forEach((q, index) => {
    const div = document.createElement('div');
    div.classList.add('card');
    div.innerHTML = `
      <p>Q${index + 1}: ${q.question}</p>
      <input type="text" name="answer${index}" placeholder="Your Answer">
    `;
    form.appendChild(div);
  });

  submitBtn.onclick = (e) => {
    e.preventDefault();
    let score = 0;

    quiz.questions.forEach((q, index) => {
      const userAnswer = form['answer' + index].value.trim();
      if (userAnswer.toLowerCase() === q.answer.trim().toLowerCase()) {
        score++;
      }
    });

    alert(`You scored ${score} out of ${quiz.questions.length}`);

    // Save score to Firebase if online quiz
    if (quizId) {
      push(ref(db, 'scores'), {
        quizTitle: quiz.title,
        score: score,
        date: new Date().toISOString()
      });
    }

    window.location.href = 'global.html';
  };
}

// Initialize quiz
loadQuiz();
</script>
</body>
</html>
